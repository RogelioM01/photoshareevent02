# FORCE Nixpacks to treat this as Node.js server, NOT SPA
# Override all automatic SPA detection
providers = ["node"]

[variables]
NODE_ENV = "production"
PORT = "5000"
# Explicitly disable SPA detection
NIXPACKS_NO_DEFAULT_CACHE_DIRS = "1"

[phases.setup]
nixPkgs = ["nodejs_18", "npm-9_x", "tsx"]
aptPkgs = ["curl", "wget"]

[phases.install]
dependsOn = ["setup"]
cmds = ["npm ci --omit=dev"]

[phases.build]
dependsOn = ["install"]
cmds = ["npm run build"]

# CRITICAL: Force server start command, disable static file serving
[start]
cmd = "npm start"